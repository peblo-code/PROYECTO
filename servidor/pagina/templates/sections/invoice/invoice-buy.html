{% extends 'header.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
    {% block cuerpo %}
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/globals.css' %}">
    <link rel="stylesheet" href="{% static 'css/section-styles/invoice.css' %}">
    <link rel="stylesheet" href="{% static 'css/section-styles/globals-section.css' %}">
    <link rel="stylesheet" href="{% static 'css/section-styles/invoice.css' %}">
    <title>Generar Compra</title>
</head>
<body>
    <div class="form-container">
        <div class="title-and-back">
            <a href="factura" style="text-decoration: none">
                <span class="icon-circle-left"></span>
            </a>
            <h1>Generar Compra</h1>
        </div>

        <div class="card menu-fade">
            <div class="card-body">
                <form action="" method="POST" class="form-invoice" id="cargarProducto">
                    {% csrf_token %}
                    <div class="form-body" id="proveedor-data">
                        <div class="form-div-invoice">
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="proveedor" placeholder="Proveedor" aria-describedby="button-addon4" disabled>
                                  <button class="btn btn-outline-primary" id="mostrarProveedores" type="button" onclick="abrirModalEdicion('{% url 'modal_view_proveedor' %}')">Buscar</button>
                            </div>
                        </div>
                        <div class="form-div-invoice">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                  <span class="input-group-text" id="inputGroup-sizing-default">RUC</span>
                                </div>
                                <input type="text" name="ruc" id="ruc"
                                class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                            </div>
                        </div>
                        <div class="form-div-invoice">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="transmision">Fecha Act.</label>
                                </div>
                                <input type="date" name="fch_actual" id="fch_actual" value={{parameters.fecha_act}}
                                class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                            </div>
                        </div>
                    </div>
                    <div class="form-body" id="factura-data">
                        <div class="form-div-invoice">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                  <label class="input-group-text" for="transmision">Nro. Timbrado</label>
                                </div>
                                <select class="form-select" id="nro_timbrado" name="nro_timbrado" onchange="cargarFecha(this)" required>
                                    <option value="" ></option>
                                </select>
                            </div>
                        </div>
                        <div class="form-div-invoice">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="">Fecha Vto.</label>
                                </div>
                                <input type="date" name="fch_vencimiento" id="fch_vencimiento" value=""
                                class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                            </div>
                        </div>
                        <div class="form-div-invoice">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                  <span class="input-group-text" id="inputGroup-sizing-default">Nro. Factura</span>
                                </div>
                                <input type="number" name="nro_factura" id="nro_factura" value="{{ parameters.datos_act.motor_vehiculo }}"
                                class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" required>
                            </div>
                        </div>
                        <div class="form-div-invoice mb-3" id="condicion-pago">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" checked>
                                <label class="form-check-label" for="flexRadioDefault1">
                                  Contado
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2">
                                <label class="form-check-label" for="flexRadioDefault2">
                                  Crédito
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="form-footer" id="btn-ver-vehiculo" style="display: none; justify-content: center;">
                    <button class="btn btn-success" id="btn-vehiculo" onclick="mostrarOcultarTabla(this)">
                        Ver Lista de Vehículos
                    </button>
                </div>
            </div>
        </div>

        <div class="card" id="data-vehiculo" style="display: none">
            <div class="card-body">
                <h3 style="margin-bottom: 1em;">Producto Seleccionado</h3>
                <section class="data-vehiculo-section">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                          <label class="input-group-text" for="marca">Marca</label>
                        </div>
                        <input type="text" id="marca" name="marca" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                    </div>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                          <label class="input-group-text" for="modelo">Modelo</label>
                        </div>
                        <input type="text" id="modelo" name="modelo" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                    </div>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                          <label class="input-group-text" for="color">Color</label>
                        </div>
                        <input type="text" id="color" name="color" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                    </div>    

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                          <label class="input-group-text" for="transmision">Transmision</label>
                        </div>
                        <input type="text" id="transmision" name="transmision" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                    </div>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroup-sizing-default">Motor</span>
                        </div>
                        <input type="text" id="motor" name="motor" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                    </div>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroup-sizing-default">Año</span>
                        </div>
                        <input type="text" id="anio" name="anio" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                    </div>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroup-sizing-default">Chasis</span>
                        </div>
                        <input type="text" id="chasis" name="chasis" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                    </div>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroup-sizing-default">Costo</span>
                        </div>
                        <input type="text" id="costo" name="costo" class="format form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                    </div>

                    <div class="input-group mb-3"> 
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inputGroup-sizing-default">Venta</span>
                        </div>
                        <input type="text" id="venta" name="venta" class="format form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default" disabled>
                    </div>
                </section>
            </div>
        </div>

        <div class="card" id="tabla-vehiculo" style="display: none">
            <div class="card-body">
                <h3>Vehiculos</h3>
                <div class="div-tabla">
                    <table id="tabla" class="table table-borderless table-hover" >
                        <thead class="table-dark">
                            <tr>
                                <th>Marca</th>
                                <th>Modelo</th>
                                <th>Motor</th>
                                <th>Año</th>
                                <th>Color</th>
                                <th>Precio Venta</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lista in parameters.listaproducto %}
                            {% if lista.estado_vehiculo == 2 %}
                            <tr>
                                {% for marca in parameters.listamarca %}
                                {% if marca.id_marca == lista.id_marca_id %}
                                <td>{{marca.descripcion_marca}}</td>
                                {% endif %}
                                {% endfor %}
            
                                {% for modelo in parameters.listamodelo %}
                                {% if modelo.id_modelo == lista.id_modelo_id %}
                                <td>{{modelo.descripcion_modelo}}</td>
                                {% endif %}
                                {% endfor %}
            
                                <td>{{ lista.motor_vehiculo }}cc</td>
            
                                <td>{{ lista.anio_vehiculo }}</td>
            
                                {% for color in parameters.listacolor %}
                                {% if color.id_color == lista.id_color_id %}
                                <td>{{color.descripcion_color}}</td>
                                {% endif %}
                                {% endfor %}
            
                                <td class="precio">{{ lista.precio_venta }}</td>
            
                                {% if lista.estado_vehiculo == 1 %}
                                <td>
                                    <span class="badge bg-success" style="color: white">DISPONIBLE</span>
                                </td>
                                {% else %}
                                <td>
                                    <span class="badge bg-secondary" style="color: white">LISTO</span>
                                </td>
                                {% endif %}
            
                                <td class="actions" style="display: flex; justify-content: center;">
                                    <button onclick="mostarSeleccionado(this, '{{lista.id_vehiculo}}')" class="btn btn-info">Seleccionar Producto</button>
                                </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="edicion" role="dialog">

    </div>

    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/sweetalert2.all.min.js' %}"></script>
    <script src="{% static 'js/alerts.js' %}"></script>
    <script src="{% static 'js/datatables.js'%}"></script>
    <script src="{% static 'js/functions.js'%}"></script>
    <script type="text/javascript" src="{% static 'js/DataTables/js/datatables.min.js' %}"></script>
    <script>
        dataTable()
        var $ = jQuery.noConflict();
        function abrirModalEdicion(url) {
            $('#edicion').load(url, function () {
                $(this).modal('show');
            })
        }
        
        function cargarFecha(event) {
            var auxTimbrado = ""
            var inputFch = document.getElementById("fch_vencimiento")
            {% for timbrado in parameters.listatimbrado %}
            auxTimbrado = "{{timbrado.nro_timbrado}}"
                if(auxTimbrado == event.value) {
                    inputFch.value = formatearFecha("{{timbrado.fch_vencimiento_timbrado}}")
                    console.log("{{timbrado.fch_vencimiento_timbrado}}")
                }
            {% endfor %}
        }

        flagBtn = 0
        function mostrarOcultarTabla(event) {
            if (flagBtn == 0) {
                event.className = "btn btn-warning"
                event.innerText = "Ocultar Lista de Vehículos"
                $('#tabla-vehiculo').show(500); //muestro mediante id
                $('#data-vehiculo').hide(500); //muestro mediante id
                flagBtn = 1

            } else {
                event.className = "btn btn-success"
                event.innerText = "Ver Lista de Vehículos"
                $('#tabla-vehiculo').hide(500); //oculto mediante id
                flagBtn = 0

            } 
        }

        function mostarSeleccionado(event, id_vehiculo) {
            $('#data-vehiculo').show(500); //muestro mediante id
            mostrarOcultarTabla(document.getElementById("btn-vehiculo"))
            cargarProducto(event, id_vehiculo)

        }

        function cargarProducto(event, id_vehiculo) {

            {% for vehiculo in parameters.listaproducto %}
                if(id_vehiculo == "{{vehiculo.id_vehiculo}}") {
                    document.getElementById("transmision").value = "{{vehiculo.transmision_vehiculo}}"
                    document.getElementById("motor").value = "{{vehiculo.motor_vehiculo}}"
                    document.getElementById("anio").value = "{{vehiculo.anio_vehiculo}}"
                    document.getElementById("chasis").value = "{{vehiculo.nro_chassis_vehiculo}}"
                    document.getElementById("costo").value = "{{vehiculo.precio_costo}}"
                    document.getElementById("venta").value = "{{vehiculo.precio_venta}}"
                }
            {% endfor %}

            // vamos al elemento padre (<tr>) y buscamos todos los elementos <td>
            // que contenga el elemento padre
            var elementosTD=event.parentElement.parentElement
            
            // recorremos cada uno de los elementos del array de elementos <td>
            document.getElementById("marca").value = elementosTD.cells.item(0).innerText;
            document.getElementById("modelo").value = elementosTD.cells.item(1).innerText;
            document.getElementById("color").value = elementosTD.cells.item(4).innerText;

        }
        
    </script>
    {% endblock %}
</body>
</html>